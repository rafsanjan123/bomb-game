<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¨Ø§Ø²ÛŒ Ø®Ù†Ø«ÛŒ Ú©Ø±Ø¯Ù† Ø¨Ù…Ø¨ Ø¨Ø§ Ù…Ø¯Ø§Ù„ Ùˆ Ø±Ú©ÙˆØ±Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: 'Vazirmatn', sans-serif; background: #f0f2f5; padding: 20px; text-align: center; }
    h1 { color: #3b5bdb; }
    #score, #highscore, #round, #timer, #medal { font-size: 1.2rem; margin: 5px 0; }
    #timer { color: #e03131; font-weight: bold; }
    #game { display: grid; grid-template-columns: repeat(5, 60px); gap: 8px; justify-content: center; margin: 20px auto; }
    .cell { width: 60px; height: 60px; background: white; border-radius: 8px; border: 2px solid #ccc; cursor: pointer; font-size: 24px; user-select: none; transition: background 0.3s; }
    .cell:hover { background: #e0e7ff; }
    .cell.revealed { cursor: default; background: #f1f3f5; }
    .cell.bomb { background: #ff6b6b; color: white; }
    #message { margin: 10px 0 20px; min-height: 24px; font-size: 1.1rem; color: #333; }
    input[type="text"] { padding: 6px; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; width: 200px; }
    button { padding: 8px 20px; margin: 10px 5px; font-size: 1rem; border-radius: 6px; border: none; background: #3b5bdb; color: white; cursor: pointer; transition: background 0.3s; }
    button:hover { background: #4c6ef5; }
    #leaderboard { max-width: 400px; margin: 30px auto 0; text-align: right; }
    #leaderboard h2 { color: #3b5bdb; margin-bottom: 10px; }
    #leaderboard ul { list-style: none; padding: 0; }
    #leaderboard li { background: white; padding: 8px; margin-bottom: 5px; border-radius: 6px; border: 1px solid #ddd; }
  </style>
</head>
<body>

  <h1>ğŸ’£ Ø¨Ø§Ø²ÛŒ Ø®Ù†Ø«ÛŒ Ú©Ø±Ø¯Ù† Ø¨Ù…Ø¨</h1>
  <div id="score">Ø§Ù…ØªÛŒØ§Ø²: 0</div>
  <div id="highscore">Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯: 0</div>
  <div id="round">Ø±Ø§Ù†Ø¯: 1</div>
  <div id="medal">ğŸ… Ù…Ø¯Ø§Ù„: Ù‡Ù†ÙˆØ² Ú†ÛŒØ²ÛŒ Ù†Ú¯Ø±ÙØªÛŒ</div>
  <div id="timer">â³ Ø²Ù…Ø§Ù†: 10</div>

  <div id="game"></div>
  <div id="message">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒ...</div>

  <div id="nameInputWrapper" style="display:none; margin-top:15px;">
    <input type="text" id="playerName" placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
    <button id="saveScoreBtn">Ø«Ø¨Øª Ø±Ú©ÙˆØ±Ø¯</button>
  </div>

  <button id="restartBtn" style="display:none;">Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>

  <div id="leaderboard">
    <h2>ğŸ† Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†ÛŒ</h2>
    <ul id="leaderboardList"></ul>
  </div>

  <script>
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase Ø®ÙˆØ¯Øª Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø²Ø§Ø±:
    const firebaseConfig = {
      apiKey: "AIzaSyAn4p0hh38oNPJymxhjuOpx1glSt827Zu0",
      authDomain: "bomb-game-project.firebaseapp.com",
      projectId: "bomb-game-project",
      storageBucket: "bomb-game-project.firebasestorage.app",
      messagingSenderId: "578216855542",
      appId: "1:578216855542:web:429ab7cc304f945a50a9d7",
      measurementId: "G-S69L08DM1Y"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§
    const gameEl = document.getElementById('game');
    const scoreEl = document.getElementById('score');
    const highscoreEl = document.getElementById('highscore');
    const roundEl = document.getElementById('round');
    const medalEl = document.getElementById('medal');
    const timerEl = document.getElementById('timer');
    const messageEl = document.getElementById('message');
    const nameInputWrapper = document.getElementById('nameInputWrapper');
    const playerNameInput = document.getElementById('playerName');
    const saveScoreBtn = document.getElementById('saveScoreBtn');
    const restartBtn = document.getElementById('restartBtn');
    const leaderboardList = document.getElementById('leaderboardList');

    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
    let score = 0;
    let highScore = 0;
    let round = 1;
    let medal = "";
    let timeLeft = 10;
    let timerInterval = null;
    let bombCount = 1;
    let bombs = [];
    let gameActive = false;
    let cellsCount = 25;
    let revealTime = 2000; // Ø²Ù…Ø§Ù† Ù†Ù…Ø§ÛŒØ´ Ø¨Ù…Ø¨ Ù‡Ø§ Ø¨Ù‡ Ù…ÛŒÙ„ÛŒ Ø«Ø§Ù†ÛŒÙ‡
    let roundsSinceBombIncrement = 0;

    // Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§
    const medals = [
      { rounds: 5, name: "Ù…Ø¯Ø§Ù„ Ø¨Ø±Ù†Ø²ÛŒ", icon: "ğŸ¥‰" },
      { rounds: 10, name: "Ù…Ø¯Ø§Ù„ Ù†Ù‚Ø±Ù‡â€ŒØ§ÛŒ", icon: "ğŸ¥ˆ" },
      { rounds: 15, name: "Ù…Ø¯Ø§Ù„ Ø·Ù„Ø§ÛŒÛŒ", icon: "ğŸ¥‡" },
      { rounds: 20, name: "Ø³Ù†Ú¯ Ú©Ù‡Ø±Ø¨Ø§", icon: "ğŸ’" },
      { rounds: 25, name: "Ø³Ù†Ú¯ Ø§Ù„Ù…Ø§Ø³", icon: "ğŸ”·" }
    ];

    function updateMedal() {
      medal = "";
      for(let i = medals.length - 1; i >= 0; i--) {
        if(round > medals[i].rounds) {
          medal = medals[i].icon + " " + medals[i].name;
          break;
        }
      }
      if(!medal) medal = "ğŸ… Ù‡Ù†ÙˆØ² Ú†ÛŒØ²ÛŒ Ù†Ú¯Ø±ÙØªÛŒ";
      medalEl.textContent = `Ù…Ø¯Ø§Ù„: ${medal}`;
    }

    function createGrid() {
      gameEl.innerHTML = '';
      for(let i=0; i<cellsCount; i++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.index = i;
        gameEl.appendChild(cell);
      }
    }

    function placeBombs() {
      bombs = [];
      while(bombs.length < bombCount) {
        let pos = Math.floor(Math.random() * cellsCount);
        if(!bombs.includes(pos)) bombs.push(pos);
      }
    }

    function showBombs() {
      bombs.forEach(pos => {
        const cell = gameEl.querySelector(`.cell[data-index="${pos}"]`);
        if(cell) {
          cell.classList.add('bomb');
          cell.textContent = "ğŸ’£";
        }
      });
    }

    function hideBombs() {
      bombs.forEach(pos => {
        const cell = gameEl.querySelector(`.cell[data-index="${pos}"]`);
        if(cell) {
          cell.classList.remove('bomb');
          cell.textContent = "";
        }
      });
    }

    function startTimer() {
      timeLeft = 10 * Math.pow(0.9, round -1); // Ù‡Ø± Ø±Ø§Ù†Ø¯ 10% Ú©Ù… Ù…ÛŒØ´Ù‡
      timeLeft = parseFloat(timeLeft.toFixed(1)); // Ø¹Ø¯Ø¯ Ø¨Ø§ ÛŒÚ© Ø±Ù‚Ù… Ø§Ø¹Ø´Ø§Ø±
      updateTimerDisplay();

      if(timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft -= 0.1;
        if(timeLeft <= 0) {
          timeLeft = 0;
          updateTimerDisplay();
          clearInterval(timerInterval);
          gameOver("Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯!");
        } else {
          updateTimerDisplay();
        }
      }, 100);
    }

    function updateTimerDisplay() {
      timerEl.textContent = `â³ Ø²Ù…Ø§Ù†: ${timeLeft.toFixed(1)}`;
    }

    function startRound() {
      gameActive = false;
      roundEl.textContent = `Ø±Ø§Ù†Ø¯: ${round}`;
      scoreEl.textContent = `Ø§Ù…ØªÛŒØ§Ø²: ${score}`;
      updateMedal();
      createGrid();
      placeBombs();
      showBombs();
      messageEl.textContent = 'Ø¨Ù…Ø¨â€ŒÙ‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù†Ø¯ØŒ Ø®ÙˆØ¨ Ù†Ú¯Ø§Ù‡ Ú©Ù†...';

      // Ù†Ù…Ø§ÛŒØ´ Ø¨Ù…Ø¨ Ù‡Ø§ Ø¨Ø±Ø§ÛŒ revealTime Ø¨Ø¹Ø¯ Ù…Ø®ÙÛŒ Ú©Ù† Ùˆ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
      setTimeout(() => {
        hideBombs();
        messageEl.textContent = 'Ø­Ø§Ù„Ø§ Ø¨Ù…Ø¨ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†!';
        gameActive = true;
        startTimer();
      }, revealTime);

      // Ù‡Ø± 3 Ø±Ø§Ù†Ø¯ ÛŒÚ© Ø¨Ù…Ø¨ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
      roundsSinceBombIncrement++;
      if(roundsSinceBombIncrement >= 3) {
        bombCount++;
        roundsSinceBombIncrement = 0;
      }

      restartBtn.style.display = 'none';
      nameInputWrapper.style.display = 'none';
    }

    function gameOver(msg) {
      gameActive = false;
      messageEl.textContent = msg;
      restartBtn.style.display = 'inline-block';
      // Ø§Ú¯Ø± Ø±Ú©ÙˆØ±Ø¯ Ø´Ú©Ø³ØªÙ‡ Ø´Ø¯ Ø§Ø¬Ø§Ø²Ù‡ Ø«Ø¨Øª Ø¨Ø¯Ù‡
      if(score > highScore) {
        highScore = score;
        highscoreEl.textContent = `Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø±Ú©ÙˆØ±Ø¯: ${highScore}`;
        nameInputWrapper.style.display = 'block';
      }
    }

    function handleClick(e) {
      if(!gameActive) return;
      const cell = e.target;
      if(!cell.classList.contains('cell')) return;

      const index
